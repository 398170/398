{% extends 'layout.html' %}

{% block content %}
<h1>{{ video['title'] }}</h1>
<video width="100%" controls>
    <source src="{{ url_for('static', filename='hls/' + video['id'] + '/index.m3u8') }}" type="application/x-mpegURL">
    ご使用のブラウザでは動画が再生できません。
</video>
<p>{{ video['description'] }}</p>

<h3>コメント</h3>
{% if current_user.is_authenticated %}
    <form method="post">
        <div class="mb-3">
            <textarea class="form-control" name="comment" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">コメントを投稿</button>
    </form>
{% else %}
    <p>ログインしてコメントを投稿してください。</p>
{% endif %}

<ul class="list-group mt-3">
    {% for comment in comments %}
        <li class="list-group-item">
            <strong>{{ comment['username'] }}:</strong> {{ comment['text'] }}
        </li>
    {% endfor %}
</ul>

<div class="mt-3">
    <form method="post">
        <button type="submit" name="like" class="btn btn-outline-primary">いいね ({{ video['likes'] }})</button>
    </form>
</div>

<h3>タグ</h3>
<p>
    {% for tag in video['tags'] %}
        <span class="badge bg-secondary">{{ tag }}</span>
    {% endfor %}
</p>

<h3>類似動画</h3>
<ul class="list-group">
    {% for related_video in related_videos %}
        <li class="list-group-item">
            <a href="{{ url_for('video_page', video_id=related_video['id']) }}">
                {{ related_video['title'] }}
            </a>
        </li>
    {% endfor %}
</ul>
{% endblock %}
